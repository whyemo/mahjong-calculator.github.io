<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä¸Šæµ·éº»å°†è®°è´¦å·¥å…·</title>
    <style>
        /* å…¨å±€æ ·å¼ - ä¿®å¤æ»šåŠ¨é—®é¢˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background-color: #f5f5f5;
            padding: 15px;
            min-height: 100vh;
            overflow-x: hidden; /* ä¿®å¤å¼¹çª—æ»šåŠ¨å†²çª */
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        /* æ ‡é¢˜å’Œè®¡æ—¶æ ·å¼ */
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 22px;
        }
        .timer-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .timer-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        .timer-display {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .timer-btn {
            width: auto;
            padding: 0 25px;
            height: 45px;
            line-height: 45px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            color: white;
            background-color: #07c160;
            cursor: pointer;
        }
        .timer-btn.stop {
            background-color: #f53f3f;
        }
        /* æ¨¡å—æ ·å¼ */
        .module {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .module-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .module-title small {
            font-size: 13px;
            font-weight: normal;
            color: #999;
            cursor: pointer;
        }
        /* ç©å®¶&æ–¹ä½è®¾ç½® */
        .player-position-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            gap: 10px;
        }
        .player-input {
            width: 40%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 12px;
            border-radius: 8px;
            font-size: 16px;
        }
        .position-select {
            width: 30%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 10px;
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
        }
        .player-total {
            font-size: 16px;
            color: #666;
            min-width: 80px;
            text-align: right;
        }
        /* é€šç”¨æŒ‰é’®æ ·å¼ - è‡ªæ‘¸/å‡ºå†²æŒ‰é’®é…è‰²åŒºåˆ† */
        button {
            width: 100%;
            height: 50px;
            line-height: 50px;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            color: white;
            margin: 10px 0;
            cursor: pointer;
        }
        .btn-normal {
            background-color: #07c160; /* è‡ªæ‘¸ç»¿è‰² */
        }
        .btn-chuchong {
            background-color: #ffc2c2; /* å‡ºå†²æµ…ç²‰è‰² */
            color: #333; /* æµ…ç²‰è‰²é…æ·±è‰²æ–‡å­—æ›´æ¸…æ™° */
        }
        .btn-warn {
            background-color: #f53f3f;
        }
        .btn-secondary {
            background-color: #666;
        }
        .btn-small {
            width: auto;
            height: 40px;
            line-height: 40px;
            padding: 0 12px;
            font-size: 15px;
            border-radius: 6px;
        }
        .btn-active {
            background-color: #059850 !important;
        }
        .btn-three { /* ä¸‰å£æŒ‰é’®ä¸“å±æ ·å¼ */
            background-color: #ff9500;
            margin-left: 5px;
        }
        .btn-three.active { /* ä¸‰å£é€‰ä¸­æ ·å¼ */
            background-color: #e68900 !important;
        }
        /* è‡ªå®šä¹‰é‡‘é¢æ¨¡å— */
        .custom-amount-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            gap: 10px;
        }
        .custom-name {
            width: 35%;
            font-size: 16px;
            font-weight: 500;
        }
        .amount-btn-group {
            display: flex;
            gap: 8px;
        }
        .win-btn, .lose-btn {
            width: 50px;
            height: 40px;
            line-height: 40px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            color: white;
        }
        .win-btn {
            background-color: #07c160;
        }
        .lose-btn {
            background-color: #f53f3f;
        }
        .custom-amount-input {
            flex: 1;
            height: 40px;
            line-height: 40px;
            border: 1px solid #eee;
            padding: 0 10px;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
        }
        /* èµ¢æ³•å¤‡æ³¨ä¸‹æ‹‰æ¡†æ ·å¼ */
        .remark-select {
            width: 100%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 12px;
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
            margin: 10px 0;
        }
        /* å‡ºå†²å¿«æ·è®°å½•å¼¹çª—æ ·å¼ - æ ¸å¿ƒè§„åˆ™ä¿®æ­£ */
        .chuchong-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 999;
            padding: 20px;
            overflow-y: auto;
        }
        .chuchong-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            margin-top: 50px;
        }
        .chuchong-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        .chuchong-select-item {
            margin: 12px 0;
        }
        .chuchong-label {
            font-size: 16px;
            margin-bottom: 8px;
            display: block;
        }
        .chuchong-select {
            width: 100%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 12px;
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
        }
        .chuchong-amount-input {
            width: 100%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 12px;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
            margin: 10px 0;
            inputmode: numeric;
            pattern: "[0-9]*";
        }
        /* è‡ªæ‘¸å¼¹çª—æ ·å¼ */
        .zim-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 999;
            padding: 20px;
            overflow-y: auto;
        }
        .zim-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            margin-top: 50px;
        }
        .zim-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        .zim-tip {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 6px;
            text-align: center;
        }
        .zim-player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 16px;
        }
        .zim-player-item.active {
            background-color: #07c160;
            color: white;
            border-color: #07c160;
        }
        .zim-amount-input {
            width: 100%;
            height: 45px;
            line-height: 45px;
            border: 1px solid #eee;
            padding: 0 12px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-size: 18px;
            inputmode: numeric;
            pattern: "[0-9]*";
        }
        .zim-player-name {
            font-size: 16px;
            font-weight: 500;
        }
        /* å†å²è®°å½•è¡¨æ ¼æ ·å¼ */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 10px;
        }
        .history-table th, .history-table td {
            border: 1px solid #eee;
            padding: 10px 5px;
            text-align: center;
        }
        .history-table th {
            background-color: #f8f8f8;
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        .history-table .win-num {
            color: #07c160;
            font-weight: 500;
        }
        .history-table .lose-num {
            color: #f53f3f;
            font-weight: 500;
        }
        .history-table .zero-num {
            color: #999;
        }
        .history-empty {
            text-align: center;
            color: #999;
            padding: 30px 0;
            font-size: 16px;
        }
        /* æ–¹ä½ç»Ÿè®¡æ¨¡å—æ ·å¼ */
        .tab-container {
            display: flex;
            margin-bottom: 15px;
        }
        .tab-btn {
            flex: 1;
            height: 45px;
            line-height: 45px;
            border: none;
            background-color: #eee;
            color: #666;
            font-size: 16px;
            border-radius: 0;
            margin: 0;
        }
        .tab-btn.active {
            background-color: #07c160;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .position-stat-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
        }
        /* ç»“ç®—æ¸…å•æ ·å¼ */
        .settle-item {
            font-size: 16px;
            line-height: 45px;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        .empty-tip {
            text-align: center;
            color: #999;
            padding: 20px 0;
            font-size: 16px;
        }
        /* ä¸‰å£è®¾ç½®é€šç”¨æ ·å¼ - æ›¿æ¢åŸåŒå€æ ·å¼ */
        .three-tip {
            font-size: 14px;
            color: #666;
            margin: 15px 0 8px 0;
            display: block;
            font-weight: 500;
        }
        .three-player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¸Šæµ·éº»å°†è®°è´¦å·¥å…·</h1>
        
        <!-- è®¡æ—¶æ¨¡å— -->
        <div class="timer-section">
            <div class="timer-info" id="startTime">å¼€å§‹æ—¶é—´ï¼šæœªå¼€å§‹</div>
            <div class="timer-display" id="timer">è®¡æ—¶ï¼š00:00:00</div>
            <button class="timer-btn" id="timerBtn" onclick="toggleTimer()">å¼€å§‹è®¡æ—¶</button>
        </div>

        <!-- ç©å®¶&æ–¹ä½è®¾ç½®æ¨¡å— -->
        <div class="module">
            <div class="module-title">ğŸ”¹ ç©å®¶&æ–¹ä½è®¾ç½®</div>
            <div class="player-position-item">
                <input type="text" class="player-input" id="player1" value="A" placeholder="ç©å®¶1åç§°">
                <select class="position-select" id="position1">
                    <option value="ä¸œ">ä¸œ</option>
                    <option value="å—">å—</option>
                    <option value="è¥¿">è¥¿</option>
                    <option value="åŒ—">åŒ—</option>
                </select>
                <span class="player-total" id="total1">0 å…ƒ</span>
            </div>
            <div class="player-position-item">
                <input type="text" class="player-input" id="player2" value="B" placeholder="ç©å®¶2åç§°">
                <select class="position-select" id="position2">
                    <option value="ä¸œ">ä¸œ</option>
                    <option value="å—" selected>å—</option>
                    <option value="è¥¿">è¥¿</option>
                    <option value="åŒ—">åŒ—</option>
                </select>
                <span class="player-total" id="total2">0 å…ƒ</span>
            </div>
            <div class="player-position-item">
                <input type="text" class="player-input" id="player3" value="C" placeholder="ç©å®¶3åç§°">
                <select class="position-select" id="position3">
                    <option value="ä¸œ">ä¸œ</option>
                    <option value="å—">å—</option>
                    <option value="è¥¿" selected>è¥¿</option>
                    <option value="åŒ—">åŒ—</option>
                </select>
                <span class="player-total" id="total3">0 å…ƒ</span>
            </div>
            <div class="player-position-item">
                <input type="text" class="player-input" id="player4" value="D" placeholder="ç©å®¶4åç§°">
                <select class="position-select" id="position4">
                    <option value="ä¸œ">ä¸œ</option>
                    <option value="å—">å—</option>
                    <option value="è¥¿">è¥¿</option>
                    <option value="åŒ—" selected>åŒ—</option>
                </select>
                <span class="player-total" id="total4">0 å…ƒ</span>
            </div>
        </div>

        <!-- å¿«æ·è®°å½•æ¨¡å— - æŒ‰é’®æ ·å¼åŒºåˆ† -->
        <div class="module">
            <div class="module-title">ğŸ”¹ å¿«æ·è®°å½•</div>
            <button class="btn-normal" onclick="showZimModal()">è‡ªæ‘¸</button>
            <button class="btn-chuchong" onclick="showChuchongModal()">å‡ºå†²</button>
            <button class="btn-secondary" onclick="showCustomInput()">è‡ªå®šä¹‰æœ¬å±€é‡‘é¢</button>
            <button class="btn-warn" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
        </div>

        <!-- è‡ªå®šä¹‰é‡‘é¢æ¨¡å— - ä¸‰å£è®¾ç½® -->
        <div class="module" id="customModule" style="display: none;">
            <div class="module-title">ğŸ”¹ è‡ªå®šä¹‰æœ¬å±€é‡‘é¢</div>
            <!-- èµ¢æ³•å¤‡æ³¨ä¸‹æ‹‰æ¡† -->
            <select class="remark-select" id="roundRemark">
                <option value="">â€”â€” é€‰æ‹©æœ¬å±€èµ¢æ³•ï¼ˆå¯é€‰ï¼‰â€”â€”</option>
                <option value="æ¸…ä¸€è‰²">æ¸…ä¸€è‰²</option>
                <option value="æ··ç¢°">æ··ç¢°</option>
                <option value="æ å¼€">æ å¼€</option>
                <option value="å…¨é£å‘">å…¨é£å‘</option>
                <option value="ä¸ƒå°å¯¹">ä¸ƒå°å¯¹</option>
                <option value="å¤§åŠè½¦">å¤§åŠè½¦</option>
            </select>
            <!-- ä¸‰å£è®¾ç½® - æ›¿æ¢åŸåŒå€æ”¯ä»˜ -->
            <label class="three-tip">ä¸‰å£è®¾ç½®ï¼ˆå‚ä¸è¾“èµ¢åˆ†æ‹…ï¼‰ï¼š</label>
            <div class="three-player-item" id="customThree1" onclick="toggleCustomThree(1)">
                <span class="zim-player-name" id="customThreeName1">A</span>
                <button class="btn-small btn-three" id="customThreeBtn1">æ˜¯å¦ä¸‰å£</button>
            </div>
            <div class="three-player-item" id="customThree2" onclick="toggleCustomThree(2)">
                <span class="zim-player-name" id="customThreeName2">B</span>
                <button class="btn-small btn-three" id="customThreeBtn2">æ˜¯å¦ä¸‰å£</button>
            </div>
            <div class="three-player-item" id="customThree3" onclick="toggleCustomThree(3)">
                <span class="zim-player-name" id="customThreeName3">C</span>
                <button class="btn-small btn-three" id="customThreeBtn3">æ˜¯å¦ä¸‰å£</button>
            </div>
            <div class="three-player-item" id="customThree4" onclick="toggleCustomThree(4)">
                <span class="zim-player-name" id="customThreeName4">D</span>
                <button class="btn-small btn-three" id="customThreeBtn4">æ˜¯å¦ä¸‰å£</button>
            </div>
            <!-- ç©å®¶1 -->
            <div class="custom-amount-item">
                <span class="custom-name" id="customName1">A</span>
                <div class="amount-btn-group">
                    <button class="win-btn" onclick="setAmountType(1, 'win')">èµ¢</button>
                    <button class="lose-btn" onclick="setAmountType(1, 'lose')">è¾“</button>
                </div>
                <input type="number" class="custom-amount-input" id="custom1" placeholder="é‡‘é¢" value="" data-type="none">
            </div>
            <!-- ç©å®¶2 -->
            <div class="custom-amount-item">
                <span class="custom-name" id="customName2">B</span>
                <div class="amount-btn-group">
                    <button class="win-btn" onclick="setAmountType(2, 'win')">èµ¢</button>
                    <button class="lose-btn" onclick="setAmountType(2, 'lose')">è¾“</button>
                </div>
                <input type="number" class="custom-amount-input" id="custom2" placeholder="é‡‘é¢" value="" data-type="none">
            </div>
            <!-- ç©å®¶3 -->
            <div class="custom-amount-item">
                <span class="custom-name" id="customName3">C</span>
                <div class="amount-btn-group">
                    <button class="win-btn" onclick="setAmountType(3, 'win')">èµ¢</button>
                    <button class="lose-btn" onclick="setAmountType(3, 'lose')">è¾“</button>
                </div>
                <input type="number" class="custom-amount-input" id="custom3" placeholder="é‡‘é¢" value="" data-type="none">
            </div>
            <!-- ç©å®¶4 -->
            <div class="custom-amount-item">
                <span class="custom-name" id="customName4">D</span>
                <div class="amount-btn-group">
                    <button class="win-btn" onclick="setAmountType(4, 'win')">èµ¢</button>
                    <button class="lose-btn" onclick="setAmountType(4, 'lose')">è¾“</button>
                </div>
                <input type="number" class="custom-amount-input" id="custom4" placeholder="é‡‘é¢" value="" data-type="none">
            </div>
            <button class="btn-normal" onclick="addCustomRound()">ç¡®è®¤è®°å½•</button>
            <button class="btn-secondary" onclick="clearCustomAmount()">æ¸…ç©ºæœ¬å±€é‡‘é¢</button>
            <button class="btn-secondary" onclick="hideCustomInput()">å–æ¶ˆ</button>
        </div>

        <!-- å‡ºå†²å¿«æ·è®°å½•å¼¹çª— - æ ¸å¿ƒè§„åˆ™é‡æ„ï¼šä¸‰å£ç©å®¶å…±åŒåˆ†æ‹…è´¹ç”¨ -->
        <div class="chuchong-modal" id="chuchongModal" style="display: none;">
            <div class="chuchong-content">
                <div class="chuchong-title">å‡ºå†²è®°å½•</div>
                <!-- èµ¢æ³•å¤‡æ³¨ -->
                <select class="remark-select" id="chuchongRemark">
                    <option value="">â€”â€” é€‰æ‹©æœ¬å±€èµ¢æ³•ï¼ˆå¯é€‰ï¼‰â€”â€”</option>
                    <option value="æ¸…ä¸€è‰²">æ¸…ä¸€è‰²</option>
                    <option value="æ··ç¢°">æ··ç¢°</option>
                    <option value="æ å¼€">æ å¼€</option>
                    <option value="å…¨é£å‘">å…¨é£å‘</option>
                    <option value="ä¸ƒå°å¯¹">ä¸ƒå°å¯¹</option>
                    <option value="å¤§åŠè½¦">å¤§åŠè½¦</option>
                </select>
                <!-- é€‰æ‹©å‡ºå†²ç©å®¶ï¼ˆè¾“å®¶ï¼‰ -->
                <div class="chuchong-select-item">
                    <label class="chuchong-label">å‡ºå†²ç©å®¶ï¼ˆåŸºç¡€è¾“å®¶ï¼‰</label>
                    <select class="chuchong-select" id="chuchongLoser">
                        <option value="1">A</option>
                        <option value="2">B</option>
                        <option value="3">C</option>
                        <option value="4">D</option>
                    </select>
                </div>
                <!-- é€‰æ‹©èµ¢å®¶ -->
                <div class="chuchong-select-item">
                    <label class="chuchong-label">èµ¢å®¶</label>
                    <select class="chuchong-select" id="chuchongWinner">
                        <option value="1">A</option>
                        <option value="2" selected>B</option>
                        <option value="3">C</option>
                        <option value="4">D</option>
                    </select>
                </div>
                <!-- åŸºç¡€é‡‘é¢è¾“å…¥ -->
                <input type="number" class="chuchong-amount-input" id="chuchongAmount" placeholder="è¾“å…¥åŸºç¡€å•ä»½é‡‘é¢" value="10" inputmode="numeric" pattern="[0-9]*">
                <!-- æ ¸å¿ƒï¼šä¸‰å£è®¾ç½®ï¼ˆé™¤èµ¢å®¶å¤–å‡å¯é€‰æ‹©ï¼Œé€‰ä¸­åˆ™å…±åŒåˆ†æ‹…å‡ºå†²è´¹ç”¨ï¼‰ -->
                <label class="three-tip">ä¸‰å£è®¾ç½®ï¼ˆé€‰ä¸­=å‚ä¸è´¹ç”¨åˆ†æ‹…ï¼Œé™¤èµ¢å®¶å¤–å‡å¯é€‰ï¼‰ï¼š</label>
                <div id="chuchongThreeContainer">
                    <div class="three-player-item" id="chuchongThree1" onclick="toggleChuchongThree(1)">
                        <span class="zim-player-name" id="chuchongThreeName1">A</span>
                        <button class="btn-small btn-three" id="chuchongThreeBtn1">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="chuchongThree2" onclick="toggleChuchongThree(2)">
                        <span class="zim-player-name" id="chuchongThreeName2">B</span>
                        <button class="btn-small btn-three" id="chuchongThreeBtn2">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="chuchongThree3" onclick="toggleChuchongThree(3)">
                        <span class="zim-player-name" id="chuchongThreeName3">C</span>
                        <button class="btn-small btn-three" id="chuchongThreeBtn3">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="chuchongThree4" onclick="toggleChuchongThree(4)">
                        <span class="zim-player-name" id="chuchongThreeName4">D</span>
                        <button class="btn-small btn-three" id="chuchongThreeBtn4">æ˜¯å¦ä¸‰å£</button>
                    </div>
                </div>
                <button class="btn-normal" onclick="confirmChuchong()">ç¡®è®¤è®°å½•</button>
                <button class="btn-secondary" onclick="hideChuchongModal()">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- è‡ªæ‘¸å¼¹çª— - ä¸‰å£è®¾ç½®ä¿ç•™ -->
        <div class="zim-modal" id="zimModal" style="display: none;">
            <div class="zim-content">
                <div class="zim-title">è‡ªæ‘¸è®°å½•</div>
                <!-- èµ¢æ³•å¤‡æ³¨ -->
                <select class="remark-select" id="zimRemark">
                    <option value="">â€”â€” é€‰æ‹©æœ¬å±€èµ¢æ³•ï¼ˆå¯é€‰ï¼‰â€”â€”</option>
                    <option value="æ¸…ä¸€è‰²">æ¸…ä¸€è‰²</option>
                    <option value="æ··ç¢°">æ··ç¢°</option>
                    <option value="æ å¼€">æ å¼€</option>
                    <option value="å…¨é£å‘">å…¨é£å‘</option>
                    <option value="ä¸ƒå°å¯¹">ä¸ƒå°å¯¹</option>
                    <option value="å¤§åŠè½¦">å¤§åŠè½¦</option>
                </select>
                <div class="zim-tip">è¯·é€‰æ‹©è‡ªæ‘¸ç©å®¶ï¼Œä¸‰å£ç©å®¶å°†å…±åŒåˆ†æ‹…è¾“å®¶è´¹ç”¨</div>
                <!-- è‡ªæ‘¸ç©å®¶é€‰æ‹© -->
                <div class="zim-player-item" id="zimPlayer1" onclick="selectZimPlayer(1)">
                    <span class="zim-player-name">A</span>
                    <span>âœ“ è‡ªæ‘¸</span>
                </div>
                <div class="zim-player-item" id="zimPlayer2" onclick="selectZimPlayer(2)">
                    <span class="zim-player-name">B</span>
                    <span>âœ“ è‡ªæ‘¸</span>
                </div>
                <div class="zim-player-item" id="zimPlayer3" onclick="selectZimPlayer(3)">
                    <span class="zim-player-name">C</span>
                    <span>âœ“ è‡ªæ‘¸</span>
                </div>
                <div class="zim-player-item" id="zimPlayer4" onclick="selectZimPlayer(4)">
                    <span class="zim-player-name">D</span>
                    <span>âœ“ è‡ªæ‘¸</span>
                </div>
                <!-- é‡‘é¢è¾“å…¥ -->
                <input type="number" class="zim-amount-input" id="zimAmount" placeholder="è¯·è¾“å…¥åŸºç¡€å•ä»½è¾“çš„é‡‘é¢" value="10" inputmode="numeric" pattern="[0-9]*">
                <!-- éè‡ªæ‘¸ç©å®¶ä¸‰å£è®¾ç½® -->
                <div id="zimThreeContainer" style="display: none;">
                    <div class="zim-tip" style="margin-top: 0;">éè‡ªæ‘¸ç©å®¶ä¸‰å£è®¾ç½®ï¼ˆé€‰ä¸­=å‚ä¸è´¹ç”¨åˆ†æ‹…ï¼‰</div>
                    <div class="three-player-item" id="zimThree1" onclick="toggleZimThree(1)">
                        <span class="zim-player-name">A</span>
                        <button class="btn-small btn-three" id="threeBtn1">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="zimThree2" onclick="toggleZimThree(2)">
                        <span class="zim-player-name">B</span>
                        <button class="btn-small btn-three" id="threeBtn2">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="zimThree3" onclick="toggleZimThree(3)">
                        <span class="zim-player-name">C</span>
                        <button class="btn-small btn-three" id="threeBtn3">æ˜¯å¦ä¸‰å£</button>
                    </div>
                    <div class="three-player-item" id="zimThree4" onclick="toggleZimThree(4)">
                        <span class="zim-player-name">D</span>
                        <button class="btn-small btn-three" id="threeBtn4">æ˜¯å¦ä¸‰å£</button>
                    </div>
                </div>
                <button class="btn-normal" onclick="confirmZim()">ç¡®è®¤è®°å½•</button>
                <button class="btn-secondary" onclick="hideZimModal()">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- å†å²è®°å½•+æ–¹ä½ç»Ÿè®¡ Tabæ¨¡å— -->
        <div class="module">
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('history')">æ¯å±€å†å²è®°å½•</button>
                <button class="tab-btn" onclick="switchTab('position')">æ–¹ä½èƒœç‡ç»Ÿè®¡</button>
            </div>
            <!-- å†å²è®°å½•Tab -->
            <div class="tab-content active" id="historyTab">
                <div id="historyList">
                    <div class="history-empty">æš‚æ— å¯¹å±€è®°å½•ï½</div>
                </div>
            </div>
            <!-- æ–¹ä½ç»Ÿè®¡Tab -->
            <div class="tab-content" id="positionTab">
                <div class="position-stat-item">
                    <span>ä¸œæ–¹ä½æ€»èµ¢é¢ï¼š</span>
                    <span id="statEast">0 å…ƒ</span>
                </div>
                <div class="position-stat-item">
                    <span>å—æ–¹ä½æ€»èµ¢é¢ï¼š</span>
                    <span id="statSouth">0 å…ƒ</span>
                </div>
                <div class="position-stat-item">
                    <span>è¥¿æ–¹ä½æ€»èµ¢é¢ï¼š</span>
                    <span id="statWest">0 å…ƒ</span>
                </div>
                <div class="position-stat-item">
                    <span>åŒ—æ–¹ä½æ€»èµ¢é¢ï¼š</span>
                    <span id="statNorth">0 å…ƒ</span>
                </div>
                <div class="position-stat-item">
                    <span>ä¸œæ–¹ä½å¯¹å±€æ•°ï¼š</span>
                    <span id="gameEast">0 å±€</span>
                </div>
                <div class="position-stat-item">
                    <span>å—æ–¹ä½å¯¹å±€æ•°ï¼š</span>
                    <span id="gameSouth">0 å±€</span>
                </div>
                <div class="position-stat-item">
                    <span>è¥¿æ–¹ä½å¯¹å±€æ•°ï¼š</span>
                    <span id="gameWest">0 å±€</span>
                </div>
                <div class="position-stat-item">
                    <span>åŒ—æ–¹ä½å¯¹å±€æ•°ï¼š</span>
                    <span id="gameNorth">0 å±€</span>
                </div>
                <div class="empty-tip" style="margin-top: 20px;">
                    æ•°æ®ä¼šéšå¯¹å±€è®°å½•è‡ªåŠ¨ç»Ÿè®¡ï¼Œç©å¾—è¶Šå¤šè¶Šå‡†ï½
                </div>
            </div>
        </div>

        <!-- ç»“ç®—æ¸…å•æ¨¡å— -->
        <div class="module">
            <div class="module-title">ğŸ”¹ æœ€ç»ˆç»“ç®—æ¸…å•</div>
            <div id="settleList">
                <div class="empty-tip">æš‚æ— è®°å½•ï¼Œå…ˆæ·»åŠ å¯¹å±€ç»“æœå§ï½</div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å…¨å±€æ•°æ®
        let players = JSON.parse(localStorage.getItem('mahjongPlayers')) || [
            { id: 1, name: 'A', total: 0, position: 'ä¸œ' },
            { id: 2, name: 'B', total: 0, position: 'å—' },
            { id: 3, name: 'C', total: 0, position: 'è¥¿' },
            { id: 4, name: 'D', total: 0, position: 'åŒ—' }
        ];
        let historyRecords = JSON.parse(localStorage.getItem('mahjongHistory')) || [];
        // è®¡æ—¶ç›¸å…³
        let timerInterval = null;
        let startTime = null;
        let isTiming = false;
        let elapsedSeconds = 0;
        // è‡ªæ‘¸ç›¸å…³
        let selectedZimPlayerId = null;
        let zimThreeMap = { 1: false, 2: false, 3: false, 4: false }; // ä¸‰å£æ›¿æ¢åŒå€
        // å‡ºå†²ç›¸å…³ - æ ¸å¿ƒï¼šä¸‰å£ç©å®¶å…±åŒåˆ†æ‹…è´¹ç”¨
        let chuchongThreeMap = { 1: false, 2: false, 3: false, 4: false }; // ä¸‰å£æ›¿æ¢åŒå€
        // è‡ªå®šä¹‰é‡‘é¢ç›¸å…³
        let customThreeMap = { 1: false, 2: false, 3: false, 4: false }; // ä¸‰å£æ›¿æ¢åŒå€

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            updatePlayerDisplay();
            calcSettleList();
            updateHistoryDisplay();
            updatePositionStat();
            // ç›‘å¬ç©å®¶åç§°ä¿®æ”¹
            document.getElementById('player1').addEventListener('input', updatePlayerName);
            document.getElementById('player2').addEventListener('input', updatePlayerName);
            document.getElementById('player3').addEventListener('input', updatePlayerName);
            document.getElementById('player4').addEventListener('input', updatePlayerName);
            // ç›‘å¬æ–¹ä½ä¿®æ”¹
            document.getElementById('position1').addEventListener('change', updatePlayerPosition);
            document.getElementById('position2').addEventListener('change', updatePlayerPosition);
            document.getElementById('position3').addEventListener('change', updatePlayerPosition);
            document.getElementById('position4').addEventListener('change', updatePlayerPosition);
            // ç›‘å¬å‡ºå†²èµ¢å®¶é€‰æ‹©å˜åŒ–ï¼Œæ›´æ–°ä¸‰å£åˆ—è¡¨æ˜¾ç¤ºï¼ˆéšè—èµ¢å®¶ï¼‰
            document.getElementById('chuchongWinner').addEventListener('change', function() {
                updateChuchongThreeList();
                resetChuchongThree();
            });
            document.getElementById('chuchongLoser').addEventListener('change', function() {
                resetChuchongThree();
            });
            // æ¢å¤è®¡æ—¶çŠ¶æ€
            const timerData = JSON.parse(localStorage.getItem('mahjongTimer'));
            if (timerData && timerData.isTiming) {
                startTime = new Date(timerData.startTime);
                isTiming = true;
                elapsedSeconds = timerData.elapsedSeconds;
                document.getElementById('startTime').textContent = `å¼€å§‹æ—¶é—´ï¼š${formatTime(startTime)}`;
                document.getElementById('timerBtn').textContent = 'ç»“æŸè®¡æ—¶';
                document.getElementById('timerBtn').classList.add('stop');
                startTimerInterval();
                updateTimerDisplay();
            }
            // åˆå§‹åŒ–ä¸‰å£æŒ‰é’®æ˜¾ç¤º
            updateCustomThreeNames();
            updateChuchongThreeNames();
            updateChuchongThreeList();
        };

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´
        function formatTime(date) {
            if (!date) return 'æœªå¼€å§‹';
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hour = date.getHours().toString().padStart(2, '0');
            const minute = date.getMinutes().toString().padStart(2, '0');
            const second = date.getSeconds().toString().padStart(2, '0');
            return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–è®¡æ—¶
        function formatElapsedTime(seconds) {
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        // è®¡æ—¶åŠŸèƒ½
        function toggleTimer() {
            if (!isTiming) {
                startTime = new Date();
                isTiming = true;
                elapsedSeconds = 0;
                document.getElementById('startTime').textContent = `å¼€å§‹æ—¶é—´ï¼š${formatTime(startTime)}`;
                document.getElementById('timerBtn').textContent = 'ç»“æŸè®¡æ—¶';
                document.getElementById('timerBtn').classList.add('stop');
                startTimerInterval();
            } else {
                clearInterval(timerInterval);
                isTiming = false;
                document.getElementById('timerBtn').textContent = 'å¼€å§‹è®¡æ—¶';
                document.getElementById('timerBtn').classList.remove('stop');
                alert(`éº»å°†å¯¹å±€ç»“æŸï¼æ€»æ—¶é•¿ï¼š${formatElapsedTime(elapsedSeconds)}`);
            }
            localStorage.setItem('mahjongTimer', JSON.stringify({
                isTiming,
                startTime: startTime ? startTime.toISOString() : null,
                elapsedSeconds
            }));
        }
        function startTimerInterval() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                elapsedSeconds++;
                updateTimerDisplay();
                localStorage.setItem('mahjongTimer', JSON.stringify({
                    isTiming,
                    startTime: startTime ? startTime.toISOString() : null,
                    elapsedSeconds
                }));
            }, 1000);
        }
        function updateTimerDisplay() {
            document.getElementById('timer').textContent = `è®¡æ—¶ï¼š${formatElapsedTime(elapsedSeconds)}`;
        }

        // æ›´æ–°ç©å®¶åç§°
        function updatePlayerName() {
            players[0].name = document.getElementById('player1').value || 'A';
            players[1].name = document.getElementById('player2').value || 'B';
            players[2].name = document.getElementById('player3').value || 'C';
            players[3].name = document.getElementById('player4').value || 'D';
            // åŒæ­¥æ‰€æœ‰æ¨¡å—åç§°
            document.getElementById('customName1').textContent = players[0].name;
            document.getElementById('customName2').textContent = players[1].name;
            document.getElementById('customName3').textContent = players[2].name;
            document.getElementById('customName4').textContent = players[3].name;
            document.getElementById('zimPlayer1').querySelector('.zim-player-name').textContent = players[0].name;
            document.getElementById('zimPlayer2').querySelector('.zim-player-name').textContent = players[1].name;
            document.getElementById('zimPlayer3').querySelector('.zim-player-name').textContent = players[2].name;
            document.getElementById('zimPlayer4').querySelector('.zim-player-name').textContent = players[3].name;
            document.getElementById('zimThree1').querySelector('.zim-player-name').textContent = players[0].name;
            document.getElementById('zimThree2').querySelector('.zim-player-name').textContent = players[1].name;
            document.getElementById('zimThree3').querySelector('.zim-player-name').textContent = players[2].name;
            document.getElementById('zimThree4').querySelector('.zim-player-name').textContent = players[3].name;
            // æ›´æ–°å‡ºå†²å¼¹çª—ä¸‹æ‹‰æ¡†
            const chuchongLoser = document.getElementById('chuchongLoser');
            const chuchongWinner = document.getElementById('chuchongWinner');
            chuchongLoser.options[0].text = players[0].name;
            chuchongLoser.options[1].text = players[1].name;
            chuchongLoser.options[2].text = players[2].name;
            chuchongLoser.options[3].text = players[3].name;
            chuchongWinner.options[0].text = players[0].name;
            chuchongWinner.options[1].text = players[1].name;
            chuchongWinner.options[2].text = players[2].name;
            chuchongWinner.options[3].text = players[3].name;
            // æ›´æ–°ä¸‰å£ç©å®¶åç§°
            updateCustomThreeNames();
            updateChuchongThreeNames();
            // ä¿å­˜å¹¶æ›´æ–°
            localStorage.setItem('mahjongPlayers', JSON.stringify(players));
            calcSettleList();
            updateHistoryDisplay();
            updatePositionStat();
        }

        // æ›´æ–°è‡ªå®šä¹‰é‡‘é¢ä¸‰å£ç©å®¶åç§°
        function updateCustomThreeNames() {
            document.getElementById('customThreeName1').textContent = players[0].name;
            document.getElementById('customThreeName2').textContent = players[1].name;
            document.getElementById('customThreeName3').textContent = players[2].name;
            document.getElementById('customThreeName4').textContent = players[3].name;
        }

        // æ›´æ–°å‡ºå†²ä¸‰å£æ”¯ä»˜çš„ç©å®¶åç§°
        function updateChuchongThreeNames() {
            document.getElementById('chuchongThreeName1').textContent = players[0].name;
            document.getElementById('chuchongThreeName2').textContent = players[1].name;
            document.getElementById('chuchongThreeName3').textContent = players[2].name;
            document.getElementById('chuchongThreeName4').textContent = players[3].name;
        }

        // æ ¹æ®é€‰æ‹©çš„èµ¢å®¶ï¼Œéšè—èµ¢å®¶çš„ä¸‰å£é€‰é¡¹ï¼Œæ˜¾ç¤ºå…¶ä»–ç©å®¶
        function updateChuchongThreeList() {
            const winnerId = Number(document.getElementById('chuchongWinner').value);
            for (let i = 1; i <= 4; i++) {
                const threeItem = document.getElementById(`chuchongThree${i}`);
                threeItem.style.display = i === winnerId ? 'none' : 'flex';
            }
        }

        // æ›´æ–°ç©å®¶æ–¹ä½
        function updatePlayerPosition() {
            players[0].position = document.getElementById('position1').value;
            players[1].position = document.getElementById('position2').value;
            players[2].position = document.getElementById('position3').value;
            players[3].position = document.getElementById('position4').value;
            localStorage.setItem('mahjongPlayers', JSON.stringify(players));
            updatePositionStat();
        }

        // æ›´æ–°ç©å®¶æ˜¾ç¤º
        function updatePlayerDisplay() {
            document.getElementById('player1').value = players[0].name;
            document.getElementById('player2').value = players[1].name;
            document.getElementById('player3').value = players[2].name;
            document.getElementById('player4').value = players[3].name;
            document.getElementById('position1').value = players[0].position;
            document.getElementById('position2').value = players[1].position;
            document.getElementById('position3').value = players[2].position;
            document.getElementById('position4').value = players[3].position;
            document.getElementById('total1').textContent = players[0].total + ' å…ƒ';
            document.getElementById('total2').textContent = players[1].total + ' å…ƒ';
            document.getElementById('total3').textContent = players[2].total + ' å…ƒ';
            document.getElementById('total4').textContent = players[3].total + ' å…ƒ';
            updatePlayerName();
        }

        // è‡ªå®šä¹‰é‡‘é¢ - èµ¢/è¾“æŒ‰é’®äº¤äº’
        function setAmountType(playerId, type) {
            const input = document.getElementById(`custom${playerId}`);
            const winBtn = input.parentElement.querySelector('.win-btn');
            const loseBtn = input.parentElement.querySelector('.lose-btn');
            winBtn.classList.remove('btn-active');
            loseBtn.classList.remove('btn-active');
            input.dataset.type = type;
            type === 'win' ? winBtn.classList.add('btn-active') : loseBtn.classList.add('btn-active');
            input.value = '';
            input.focus();
        }

        // è‡ªå®šä¹‰é‡‘é¢ - åˆ‡æ¢ä¸‰å£è®¾ç½®
        function toggleCustomThree(playerId) {
            customThreeMap[playerId] = !customThreeMap[playerId];
            const btn = document.getElementById(`customThreeBtn${playerId}`);
            if (customThreeMap[playerId]) {
                btn.classList.add('btn-active');
                btn.textContent = 'ä¸‰å£âœ“';
            } else {
                btn.classList.remove('btn-active');
                btn.textContent = 'æ˜¯å¦ä¸‰å£';
            }
        }

        // æ¸…ç©ºè‡ªå®šä¹‰é‡‘é¢
        function clearCustomAmount() {
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById(`custom${i}`);
                input.value = '';
                input.dataset.type = 'none';
                const winBtn = input.parentElement.querySelector('.win-btn');
                const loseBtn = input.parentElement.querySelector('.lose-btn');
                winBtn.classList.remove('btn-active');
                loseBtn.classList.remove('btn-active');
                // é‡ç½®ä¸‰å£
                customThreeMap[i] = false;
                const threeBtn = document.getElementById(`customThreeBtn${i}`);
                threeBtn.classList.remove('btn-active');
                threeBtn.textContent = 'æ˜¯å¦ä¸‰å£';
            }
            document.getElementById('roundRemark').value = '';
        }

        // è‡ªå®šä¹‰é‡‘é¢ï¼šè®°å½•æœ¬å±€ï¼ˆå«ä¸‰å£è®¡ç®—ï¼‰
        function addCustomRound() {
            const roundData = [];
            let total = 0;
            const remark = document.getElementById('roundRemark').value;
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById(`custom${i}`);
                const amountVal = Number(input.value) || 0;
                const type = input.dataset.type;
                // è®¡ç®—ä¸‰å£é‡‘é¢
                let baseAmount = 0;
                if (type === 'win') baseAmount = Math.abs(amountVal);
                else if (type === 'lose') baseAmount = -Math.abs(amountVal);
                // ä¸‰å£ä»…ä½œç”¨äºè¾“çš„é‡‘é¢ï¼Œé€‰ä¸­åˆ™åˆ†æ‹…å¯¹åº”è´¹ç”¨
                let finalAmount = baseAmount;
                if (baseAmount < 0 && customThreeMap[i]) {
                    finalAmount = baseAmount;
                }
                roundData.push({ id: i, amount: finalAmount });
                total += finalAmount;
            }
            if (total !== 0) {
                alert('æœ¬å±€æ”¶æ”¯ä¸å¹³è¡¡ï¼\nèµ¢çš„é’±è¦ç­‰äºè¾“çš„é’±');
                return;
            }
            addRoundRecord(roundData, remark);
            hideCustomInput();
            clearCustomAmount();
        }

        // å‡ºå†²å¿«æ·è®°å½• - åˆå§‹åŒ–
        function showChuchongModal() {
            document.getElementById('chuchongModal').style.display = 'flex';
            document.getElementById('chuchongRemark').value = '';
            document.getElementById('chuchongAmount').value = '10';
            // é‡ç½®ä¸‰å£çŠ¶æ€å’Œæ˜¾ç¤º
            resetChuchongThree();
            updateChuchongThreeList();
        }

        // é‡ç½®å‡ºå†²æ‰€æœ‰ç©å®¶çš„ä¸‰å£çŠ¶æ€
        function resetChuchongThree() {
            chuchongThreeMap = { 1: false, 2: false, 3: false, 4: false };
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`chuchongThreeBtn${i}`);
                btn.classList.remove('btn-active');
                btn.textContent = 'æ˜¯å¦ä¸‰å£';
            }
        }

        // å‡ºå†²å•ä¸ªç©å®¶åˆ‡æ¢ä¸‰å£è®¾ç½®
        function toggleChuchongThree(playerId) {
            chuchongThreeMap[playerId] = !chuchongThreeMap[playerId];
            const btn = document.getElementById(`chuchongThreeBtn${playerId}`);
            if (chuchongThreeMap[playerId]) {
                btn.classList.add('btn-active');
                btn.textContent = 'ä¸‰å£âœ“';
            } else {
                btn.classList.remove('btn-active');
                btn.textContent = 'æ˜¯å¦ä¸‰å£';
            }
        }

        function hideChuchongModal() {
            document.getElementById('chuchongModal').style.display = 'none';
        }

        // æ ¸å¿ƒé‡æ„ï¼šå‡ºå†²ç¡®è®¤è®°å½•ï¼ŒæŒ‰ã€ä¸‰å£ç©å®¶å…±åŒåˆ†æ‹…è´¹ç”¨ã€‘è§„åˆ™è®¡ç®—
        // è§„åˆ™ï¼š
        // 1. å‡ºå†²ç©å®¶ï¼ˆloserIdï¼‰é»˜è®¤å¿…æ‹…è´£ï¼Œå¿…å‡ºåŸºç¡€é‡‘é¢
        // 2. é™¤èµ¢å®¶å¤–ï¼Œå‹¾é€‰ã€Œä¸‰å£âœ“ã€çš„ç©å®¶åŠ å…¥ã€Œæ‹…è´£åˆ—è¡¨ã€ï¼Œå„å‡ºåŸºç¡€é‡‘é¢
        // 3. èµ¢å®¶è·å¾—æ‰€æœ‰æ‹…è´£ç©å®¶çš„é‡‘é¢æ€»å’Œ
        function confirmChuchong() {
            const loserId = Number(document.getElementById('chuchongLoser').value);
            const winnerId = Number(document.getElementById('chuchongWinner').value);
            const baseAmount = Number(document.getElementById('chuchongAmount').value) || 0;
            const remark = document.getElementById('chuchongRemark').value;
            
            // åŸºç¡€æ ¡éªŒ
            if (loserId === winnerId) {
                alert('å‡ºå†²ç©å®¶å’Œèµ¢å®¶ä¸èƒ½æ˜¯åŒä¸€ä¸ªäººï¼');
                return;
            }
            if (baseAmount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åŸºç¡€é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï¼');
                return;
            }

            // æ„å»ºæ‹…è´£åˆ—è¡¨ï¼šå‡ºå†²ç©å®¶é»˜è®¤åŠ å…¥ + å‹¾é€‰ä¸‰å£çš„ç©å®¶ï¼ˆæ’é™¤èµ¢å®¶ï¼‰
            const responsiblePlayers = new Set();
            responsiblePlayers.add(loserId); // å‡ºå†²ç©å®¶å¿…æ‹…è´£
            
            // éå†æ‰€æœ‰ç©å®¶ï¼Œæ·»åŠ å‹¾é€‰ä¸‰å£çš„éèµ¢å®¶ç©å®¶
            for (let i = 1; i <= 4; i++) {
                if (i !== winnerId && chuchongThreeMap[i]) {
                    responsiblePlayers.add(i);
                }
            }

            // è®¡ç®—æ¯å±€é‡‘é¢
            const roundData = [];
            let winnerTotal = 0;
            
            for (let i = 1; i <= 4; i++) {
                if (i === winnerId) {
                    // èµ¢å®¶å…ˆå ä½ï¼Œæœ€åç»Ÿä¸€èµ‹å€¼
                    roundData.push({ id: i, amount: 0 });
                } else if (responsiblePlayers.has(i)) {
                    // æ‹…è´£ç©å®¶ï¼šå‡ºåŸºç¡€é‡‘é¢ï¼ˆè´Ÿæ•°ï¼‰
                    roundData.push({ id: i, amount: -baseAmount });
                    winnerTotal += baseAmount;
                } else {
                    // éæ‹…è´£ç©å®¶ï¼š0
                    roundData.push({ id: i, amount: 0 });
                }
            }

            // ç»™èµ¢å®¶èµ‹å€¼æ€»èµ¢é¢
            roundData[winnerId - 1].amount = winnerTotal;
            
            // è®°å½•æœ¬å±€
            addRoundRecord(roundData, remark);
            hideChuchongModal();
        }

        // è‡ªæ‘¸åŠŸèƒ½
        function showZimModal() {
            document.getElementById('zimModal').style.display = 'flex';
            selectedZimPlayerId = null;
            zimThreeMap = { 1: false, 2: false, 3: false, 4: false };
            document.querySelectorAll('.zim-player-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.btn-three').forEach(btn => {
                btn.classList.remove('btn-active');
                btn.textContent = 'æ˜¯å¦ä¸‰å£';
            });
            document.getElementById('zimThreeContainer').style.display = 'none';
            document.getElementById('zimAmount').value = '10';
            document.getElementById('zimRemark').value = '';
        }
        function hideZimModal() {
            document.getElementById('zimModal').style.display = 'none';
        }
        function selectZimPlayer(id) {
            selectedZimPlayerId = id;
            document.querySelectorAll('.zim-player-item').forEach(item => item.classList.remove('active'));
            document.getElementById(`zimPlayer${id}`).classList.add('active');
            document.getElementById('zimThreeContainer').style.display = 'block';
            for (let i = 1; i <= 4; i++) {
                const threeItem = document.getElementById(`zimThree${i}`);
                threeItem.style.display = i === id ? 'none' : 'flex';
            }
        }
        function toggleZimThree(id) {
            zimThreeMap[id] = !zimThreeMap[id];
            const btn = document.getElementById(`threeBtn${id}`);
            if (zimThreeMap[id]) {
                btn.classList.add('btn-active');
                btn.textContent = 'ä¸‰å£âœ“';
            } else {
                btn.classList.remove('btn-active');
                btn.textContent = 'æ˜¯å¦ä¸‰å£';
            }
        }
        function confirmZim() {
            if (!selectedZimPlayerId) {
                alert('è¯·å…ˆé€‰æ‹©è‡ªæ‘¸çš„ç©å®¶ï¼');
                return;
            }
            const baseAmount = Number(document.getElementById('zimAmount').value) || 0;
            const remark = document.getElementById('zimRemark').value;
            if (baseAmount <= 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„åŸºç¡€é‡‘é¢ï¼ˆå¤§äº0ï¼‰ï¼');
                return;
            }
            const roundData = [];
            let zimWinTotal = 0;
            for (let i = 1; i <= 4; i++) {
                if (i === selectedZimPlayerId) {
                    roundData.push({ id: i, amount: 0 });
                } else {
                    // è‡ªæ‘¸ä¸‰å£è§„åˆ™ï¼šå‹¾é€‰ä¸‰å£çš„ç©å®¶åŒå€æ”¯ä»˜
                    const payAmount = zimThreeMap[i] ? baseAmount * 2 : baseAmount;
                    roundData.push({ id: i, amount: -payAmount });
                    zimWinTotal += payAmount;
                }
            }
            roundData[selectedZimPlayerId - 1].amount = zimWinTotal;
            addRoundRecord(roundData, remark);
            hideZimModal();
        }

        // å†å²è®°å½•è¡¨æ ¼
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            if (historyRecords.length === 0) {
                historyList.innerHTML = '<div class="history-empty">æš‚æ— å¯¹å±€è®°å½•ï½</div>';
                return;
            }
            let tableHtml = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>å±€æ•°/æ—¶é—´</th>
                            <th>${players[0].name}</th>
                            <th>${players[1].name}</th>
                            <th>${players[2].name}</th>
                            <th>${players[3].name}</th>
                            <th>æœ¬å±€èµ¢æ³•</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            historyRecords.reverse().forEach((record, index) => {
                const gameNo = historyRecords.length - index;
                const timeStr = record.time.split(' ')[1];
                tableHtml += `<tr><td>ç¬¬${gameNo}å±€<br>${timeStr}</td>`;
                // ç©å®¶è¾“èµ¢
                record.details.forEach(item => {
                    let numClass = 'zero-num';
                    let amountText = item.amount;
                    if (item.amount > 0) {
                        numClass = 'win-num';
                        amountText = `+${item.amount}`;
                    } else if (item.amount < 0) {
                        numClass = 'lose-num';
                    }
                    tableHtml += `<td class="${numClass}">${amountText}</td>`;
                });
                // èµ¢æ³•å¤‡æ³¨
                const remarkText = record.remark || 'æ— ';
                tableHtml += `<td>${remarkText}</td></tr>`;
            });
            historyRecords.reverse();
            tableHtml += `
                    </tbody>
                </table>
            `;
            historyList.innerHTML = tableHtml;
        }

        // æ–¹ä½ç»Ÿè®¡æ›´æ–°
        function updatePositionStat() {
            let stat = {
                ä¸œ: { total: 0, games: 0 },
                å—: { total: 0, games: 0 },
                è¥¿: { total: 0, games: 0 },
                åŒ—: { total: 0, games: 0 }
            };
            historyRecords.forEach(record => {
                record.details.forEach(item => {
                    const player = players.find(p => p.id === item.id);
                    if (player) {
                        stat[player.position].total += item.amount;
                        stat[player.position].games += 1;
                    }
                });
            });
            document.getElementById('statEast').textContent = stat.ä¸œ.total + ' å…ƒ';
            document.getElementById('statSouth').textContent = stat.å—.total + ' å…ƒ';
            document.getElementById('statWest').textContent = stat.è¥¿.total + ' å…ƒ';
            document.getElementById('statNorth').textContent = stat.åŒ—.total + ' å…ƒ';
            document.getElementById('gameEast').textContent = stat.ä¸œ.games + ' å±€';
            document.getElementById('gameSouth').textContent = stat.å—.games + ' å±€';
            document.getElementById('gameWest').textContent = stat.è¥¿.games + ' å±€';
            document.getElementById('gameNorth').textContent = stat.åŒ—.games + ' å±€';
        }

        // Tabåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // é€šç”¨è®°å½•å•å±€ç»“æœæ–¹æ³•
        function addRoundRecord(roundData, remark = '') {
            // æ›´æ–°ç©å®¶æ€»é‡‘é¢
            roundData.forEach(item => {
                const player = players.find(p => p.id === item.id);
                if (player) player.total += Number(item.amount);
            });
            // æ·»åŠ å†å²è®°å½•
            const now = new Date();
            const timeStr = formatTime(now);
            historyRecords.push({
                time: timeStr,
                details: JSON.parse(JSON.stringify(roundData)),
                remark: remark
            });
            // æœ¬åœ°ä¿å­˜
            localStorage.setItem('mahjongPlayers', JSON.stringify(players));
            localStorage.setItem('mahjongHistory', JSON.stringify(historyRecords));
            // æ›´æ–°æ‰€æœ‰æ˜¾ç¤º
            updatePlayerDisplay();
            calcSettleList();
            updateHistoryDisplay();
            updatePositionStat();
            alert('è®°å½•æˆåŠŸï¼');
        }

        // ç»“ç®—æ¸…å•è®¡ç®—
        function calcSettleList() {
            const settleList = document.getElementById('settleList');
            const tempPlayers = JSON.parse(JSON.stringify(players));
            let html = '';
            const creditors = tempPlayers.filter(p => p.total > 0).sort((a, b) => b.total - a.total);
            const debtors = tempPlayers.filter(p => p.total < 0).sort((a, b) => a.total - b.total);
            if (creditors.length === 0 && debtors.length === 0) {
                html = '<div class="empty-tip">æš‚æ— è®°å½•ï¼Œå…ˆæ·»åŠ å¯¹å±€ç»“æœå§ï½</div>';
            } else {
                debtors.forEach(debtor => {
                    let debt = Math.abs(debtor.total);
                    if (debt <= 0) return;
                    creditors.forEach(creditor => {
                        if (debt <= 0 || creditor.total <= 0) return;
                        const payAmount = Math.min(debt, creditor.total);
                        html += `<div class="settle-item">${debtor.name} â†’ ${creditor.name}ï¼š${payAmount} å…ƒ</div>`;
                        debt -= payAmount;
                        creditor.total -= payAmount;
                        debtor.total += payAmount;
                    });
                });
                if (html === '') html = '<div class="empty-tip">æš‚æ— è½¬è´¦ï¼Œæ‰€æœ‰äººæ”¶æ”¯å¹³è¡¡ï½</div>';
            }
            settleList.innerHTML = html;
        }

        // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ¨¡å—
        function showCustomInput() {
            document.getElementById('customModule').style.display = 'block';
            clearCustomAmount();
        }
        function hideCustomInput() {
            document.getElementById('customModule').style.display = 'none';
        }

        // æ¸…ç©ºæ‰€æœ‰è®°å½•
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•ï¼ˆåŒ…æ‹¬å†å²ã€æ€»æ”¶æ”¯ã€è®¡æ—¶ï¼‰å—ï¼Ÿ')) {
                players = [
                    { id:1,name:'A',total:0,position:'ä¸œ' },
                    { id:2,name:'B',total:0,position:'å—' },
                    { id:3,name:'C',total:0,position:'è¥¿' },
                    { id:4,name:'D',total:0,position:'åŒ—' }
                ];
                historyRecords = [];
                clearInterval(timerInterval);
                isTiming = false;
                elapsedSeconds = 0;
                document.getElementById('startTime').textContent = 'å¼€å§‹æ—¶é—´ï¼šæœªå¼€å§‹';
                document.getElementById('timer').textContent = 'è®¡æ—¶ï¼š00:00:00';
                document.getElementById('timerBtn').textContent = 'å¼€å§‹è®¡æ—¶';
                document.getElementById('timerBtn').classList.remove('stop');
                localStorage.clear();
                updatePlayerDisplay();
                calcSettleList();
                updateHistoryDisplay();
                updatePositionStat();
                alert('å·²æ¸…ç©ºæ‰€æœ‰è®°å½•ï¼');
            }
        }
    </script>
</body>
</html>
